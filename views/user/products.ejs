<!--Product details tab-->

<!DOCTYPE HTML>
<html>
	<head>
	<title>CRUX | Product Details</title>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Rokkitt:100,300,400,700" rel="stylesheet">
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="/front/css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="/front//css/icomoon.css">
	<!-- Ion Icon Fonts-->
	<link rel="stylesheet" href="/front/css/ionicons.min.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="/front/css/bootstrap.min.css">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="/front/css/magnific-popup.css">

	<!-- Flexslider  -->
	<link rel="stylesheet" href="/front/css/flexslider.css">

	<!-- Owl Carousel -->
	<link rel="stylesheet" href="/front/css/owl.carousel.min.css">
	<link rel="stylesheet" href="/front/css/owl.theme.default.min.css">
	
	<!-- Date Picker -->
	<link rel="stylesheet" href="/front/css/bootstrap-datepicker.css">
	<!-- Flaticons  -->
	<link rel="stylesheet" href="/front/fonts/flaticon/font/flaticon.css">

	<!-- Theme style  -->
	<link rel="stylesheet" href="/front/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<style>			
		.product-list {
			display: flex;
			overflow-x: auto;
			scroll-behavior: smooth;
			padding-bottom: 10px;
		}
		.scroll-btn {
			position: absolute;
			top: 50%;
			transform: translateY(-50%);
			background: white;
			border: none;
			cursor: pointer;
			font-size: 24px;
			padding: 10px;
			box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
			z-index: 10;
		}
		.left { left: -10px; }
		.right { right: -10px; }

		.main-image img {
		width: 400px;  /* Fixed width */
		height: 400px; /* Fixed height */
		object-fit: contain; /* Ensures image fits without distortion */
		border: 1px solid #ddd;
		padding: 10px;
		background: #fff;
	}
			.image-container {
			position: relative;
			width: 400px;
			height: 400px;
			border: 1px solid #ddd;
			overflow: hidden;
			background: #fff;
		}

		#mainImage {
			width: 100%;
			height: 100%;
			object-fit: contain;
			cursor: crosshair;
		}

		/* Zoom Lens (Frame that appears on hover) */
		.zoom-lens {
			position: absolute;
			width: 100px;
			height: 100px;
			background: rgba(255, 255, 255, 0.4);
			border: 1px solid #ddd;
			pointer-events: none;
			display: none;
		}

		/* Zoomed Image Preview */
		.zoom-preview {
			position: absolute;
			width: 600px;  /* Takes 1/3 of the page */
			height: 400px;
			overflow: hidden;
			border: 2px solid #ddd;
			background: #fff;
			display: none;
			z-index: 999;
			right: 0; /* Adjust as needed */
		}

		.zoom-preview img {
			position: absolute;
			width: 1000px; /* Large image size for zoom */
			height: auto;
		}


		</style>
	</head>
	<body>
		
	<div class="colorlib-loader"></div>

	<div id="page">
		<%- include('./userPartials/header') %>

           

		<div class="breadcrumbs">
			<div class="container">
				<div class="row">
					<div class="col">
						<p class="bread"><span><a href="index.html">Home</a></span> / <span>Product Details</span></p>
					</div>
				</div>
			</div>
		</div>

        <% if (message) { %>
            <div class="alert alert-warning text-center">
                <%= message %>
            </div>
        <% } %>

		          <div class="colorlib-product" style="padding:0;">
			     <!-- Product Detail Section -->
					<div class="container mt-4">
						<div class="row">
							<!-- Left: Image Gallery -->
							<div class="col-md-6 position-relative">
								<% if (product && product.images && product.images.length > 0) { %>		
									<div class="image-container">
										<img id="mainImage" src="<%= product.images[0] %>" class="img-fluid rounded shadow" alt="<%= product.name %>">
										
										<!-- Zoom Lens -->
										<div class="zoom-lens" id="zoomLens"></div>
									</div>

									 
									
										<div class="thumbnail-images d-flex justify-content-center mt-3">
											<% product.images.forEach((image, index) => { %>
												<img src="<%= image %>" class="img-thumbnail mx-1" style="width: 80px; height: 80px; cursor: pointer;" onclick="changeImage('<%= image %>')">
											<% }) %>
										</div>
									<!-- <div class="main-image text-center">
										<img id="mainImage" src="<%= product.images[0] %>" class="img-fluid rounded shadow" alt="<%= product.name %>">
									</div>
									<div class="thumbnail-images d-flex justify-content-center mt-3">
										<% product.images.forEach((image, index) => { %>
											<img src="<%= image %>" class="img-thumbnail mx-1" style="width: 80px; height: 80px; cursor: pointer;" onclick="changeImage('<%= image %>')">
										<% }) %>
									</div> -->
								<% } else { %>
									<div class="alert alert-warning text-center">No images available for this product.</div>
								<% } %>
							</div>							
							

							<!-- Right: Product Details -->
							<div class="col-md-6">
									<!-- Hidden Zoom Preview -->
								<div class="zoom-preview" id="zoomPreview">
									<img id="zoomImage" src="<%= product.images[0] %>">
								</div>
								<% if (product) { %>
								<div class="product-desc">
									<h2><%= product.name %></h2>

									<p><%= product.description %></p>
									<p class="price fs-1">
										<span>₹<%= product.finalPrice %></span>
										<% if (product.discount) { %>
											<small class="text-muted ms-2"><del>₹<%= product.price %></del></small>
										<% } %>
										<span class="text-success "><%= product.discount %>% Off</span>
									</p>
									<p class="rating">
										<% for (let i = 1; i <= 5; i++) { %>
											<i class="fa <%= i <= product.ratings ? 'fa-star text-warning' : 'fa-star text-muted' %>"></i>
										<% } %>
										<span>(<%= product.ratings %> Ratings)</span>
									</p>
									

									<h5>Available Sizes:</h5>
									<div class="btn-group mb-3">
										<% ["7", "8", "9", "10", "11", "12"].forEach(size => { %>
											<button class="btn btn-outline-dark"><%= size %></button>
										<% }) %>
									</div>

									<div class="input-group mb-4">
										<button class="btn btn-outline-dark quantity-left-minus">-</button>
										<input type="text" id="quantity" class="form-control text-center" value="1" min="1" max="100">
										<button class="btn btn-outline-dark quantity-right-plus">+</button>
									</div>

									<a href="#" class="btn btn-primary"><i class="fa fa-shopping-cart"></i> Add to Cart</a>
								</div>
								<% } else { %>
									<div class="alert alert-danger text-center">Product not found or is currently inactive.</div>
								<% } %>
							</div>
						</div>
					</div>
				</div>


			  <!-- Product Tabs -->
			  <div class="container mt-5">
				<ul class="nav nav-tabs" id="productTabs">
					<li class="nav-item">
						<a class="nav-link active" data-bs-toggle="tab" href="#brand">Brand</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" data-bs-toggle="tab" href="#description">Description</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" data-bs-toggle="tab" href="#review">Reviews</a>
					</li>
				</ul>
		
				<div class="tab-content p-4 border bg-light">
					<div class="tab-pane fade show active" id="brand">
						<div class="d-flex align-items-center mb-3">
							<img src="<%=brand.image%>" alt="<%=brand.name%>" class="rounded-circle" height="60">
							<h4 class="ms-3 mb-0"><%=brand.name%></h4>
						</div>
						<p><%= brand.description %></p>
					</div>
					<div class="tab-pane fade" id="description">
						<p><%= product.description %></p>
					</div>
					<div class="tab-pane fade" id="review">
						<% if (reviews && reviews.length > 0) { %>
							<% reviews.forEach(review => { %>
								<div class="review mb-3">
									<strong><%= review.user.username %></strong>
									<span class="text-muted float-end"><%= new Date(review.createdAt).toLocaleDateString() %></span>
									<div class="text-warning">
										<% for (let i = 1; i <= 5; i++) { %>
											<i class="fa <%= i <= review.rating ? 'fa-star' : 'fa-star text-muted' %>"></i>
										<% } %>
									</div>
									<p><%= review.comment %></p>
								</div>
							<% }) %>
						<% } else { %>
							<p>No reviews yet. Be the first to review this product.</p>
						<% } %>
					</div>
				</div>
			</div>
				</div>
				<!-- Similar Products Section -->
					<div class="container mt-5 mb-5">
						<h3>Similar Products</h3>
						<div class="position-relative">
							<!-- Scroll Buttons -->
							<button class="scroll-btn left" onclick="scrollProducts(-1)">&#10094;</button>
							<button class="scroll-btn right" onclick="scrollProducts(1)">&#10095;</button>

							<div class="product-list d-flex overflow-auto">
								<% relatedProducts.forEach(product => { %>
									<div class="card mx-2" style="min-width: 180px; max-width: 200px;">
										<div class="position-relative">
											<a href="/user/products/<%=product._id%>"><img src="<%= product.images[0] %>" class="card-img-top" alt="<%= product.name %>"></a>
											<button class="btn btn-light position-absolute top-0 end-0 m-2 rounded-circle">
												<i class="fa fa-heart"></i>
											</button>
										</div>
										<div class="card-body p-2">
											<a class="nav-link" href="/user/products/<%=product._id%>"><p class="card-title text-truncate mb-1"><%= product.name %></p></a>
											<p class="card-text mb-1">
												<strong>₹<%= product.finalPrice %></strong>
												<% if (product.discount) { %>
													<small class="text-muted ms-2"><del>₹<%= product.price %></del></small>
													<span class="text-success"> <%= product.discount %>% off</span>
												<% } %>
											</p>
										</div>
									</div>
								<% }) %>
							</div>
						</div>
					</div>
			</div>
		</div>

		<%- include('./userPartials/footer') %>
	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="ion-ios-arrow-up"></i></a>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<!-- jQuery -->
	<script src="/front/js/jquery.min.js"></script>
   <!-- popper -->
   <script src="/front/js/popper.min.js"></script>
   <!-- bootstrap 4.1 -->
   <script src="/front/js/bootstrap.min.js"></script>
   <!-- jQuery easing -->
   <script src="/front/js/jquery.easing.1.3.js"></script>
	<!-- Waypoints -->
	<script src="/front/js/jquery.waypoints.min.js"></script>
	<!-- Flexslider -->
	<script src="/front/js/jquery.flexslider-min.js"></script>
	<!-- Owl carousel -->
	<script src="/front/js/owl.carousel.min.js"></script>
	<!-- Magnific Popup -->
	<script src="/front/js/jquery.magnific-popup.min.js"></script>
	<script src="/front/js/magnific-popup-options.js"></script>
	<!-- Date Picker -->
	<script src="/front/js/bootstrap-datepicker.js"></script>
	<!-- Stellar Parallax -->
	<script src="/front/js/jquery.stellar.min.js"></script>
	<!-- Main -->
	<script src="/front/js/main.js"></script>

	<script>
	
	const mainImage = document.getElementById('mainImage');
	const zoomLens = document.getElementById('zoomLens');
	const zoomPreview = document.getElementById('zoomPreview');
	const zoomImage = document.getElementById('zoomImage');

	mainImage.addEventListener('mouseenter', function () {
		zoomLens.style.display = "block";
		zoomPreview.style.display = "block";
	});


	mainImage.addEventListener('mousemove', function (event) {
		const { left, top, width, height } = mainImage.getBoundingClientRect();
		
		// Get cursor position relative to image
		const x = event.pageX - left - window.scrollX;
		const y = event.pageY - top - window.scrollY;

		// Position zoom lens
		const lensSize = 100;  // Adjust zoom lens size
		let lensX = x - lensSize / 2;
		let lensY = y - lensSize / 2;

		// Keep lens inside image bounds
		lensX = Math.max(0, Math.min(width - lensSize, lensX));
		lensY = Math.max(0, Math.min(height - lensSize, lensY));

		zoomLens.style.left = `${lensX}px`;
		zoomLens.style.top = `${lensY}px`;

		// Position zoomed image preview
		const zoomX = (lensX / width) * 100;
		const zoomY = (lensY / height) * 100;
		zoomImage.style.transform = `translate(-${zoomX}%, -${zoomY}%)`;
	});

	mainImage.addEventListener('mouseleave', function () {
		zoomLens.style.display = "none";
		zoomPreview.style.display = "none";
	});

	function changeImage(src) {
    mainImage.src = src; // Update main image
    zoomImage.src = src; // Update zoomed preview image

    // Ensure the zoom still works after changing the image
    zoomImage.onload = function () {
        zoomLens.style.display = "none";
        zoomPreview.style.display = "none";
    };
}

	// Change main image and update zoom effect
	// function changeImage(src) {
	// 	mainImage.src = src;
	// 	zoomImage.src = src;
	// }

		// Chnage image and shift to main image
		// function changeImage(src) {
		// 	mainImage.src = src;
		// 	zoomFrame.style.backgroundImage = `url(${src})`;
		// }

	// 	function changeImage(src) {
    //     document.getElementById('mainImage').src = src;
    // }

		function scrollProducts(direction) {
        const container = document.querySelector('.product-list');
        const scrollAmount = 300; // Adjust for better UX
        container.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
		}

	
	

    document.querySelector('.quantity-right-plus').addEventListener('click', () => {
        let qty = parseInt(document.getElementById('quantity').value);
        document.getElementById('quantity').value = qty + 1;
    });

    document.querySelector('.quantity-left-minus').addEventListener('click', () => {
        let qty = parseInt(document.getElementById('quantity').value);
        if (qty > 1) document.getElementById('quantity').value = qty - 1;
    });
		$(document).ready(function(){

		var quantitiy=0;
		   $('.quantity-right-plus').click(function(e){
		        
		        // Stop acting like a button
		        e.preventDefault();
		        // Get the field name
		        var quantity = parseInt($('#quantity').val());
		        
		        // If is not undefined
		            
		            $('#quantity').val(quantity + 1);

		          
		            // Increment
		        
		    });

		     $('.quantity-left-minus').click(function(e){
		        // Stop acting like a button
		        e.preventDefault();
		        // Get the field name
		        var quantity = parseInt($('#quantity').val());
		        
		        // If is not undefined
		      
		            // Increment
		            if(quantity>0){
		            $('#quantity').val(quantity - 1);
		            }
		    });
		    
		});
	</script>


	</body>
</html>

